library(tidyverse)
install.packages(tidyverse)
install.packages('tidyverse')
library(tidyverse)
setwd('C:\Users\admin\Desktop\Classes\Mgr\Semestr_1\Warsztaty\HSBC - Credit Risk data preparation with Tidyverse\')
setwd('C:/Users/admin/Desktop/Classes/Mgr/Semestr_1/Warsztaty/HSBC - Credit Risk data preparation with Tidyverse/')
DATA <- read_csv('KNMF_data')
DATA <- read_csv('KNMF_data.csv')
head(DATA)
str(DATA)
head(DATA)
# Sex
DATA %>% select(sex)
# Sex
DATA %>% select(Sex)
# Sex
DATA %>% select(Sex) %>% group_by(Sex) %>% summarize(n=n())
# Sex
DATA %>%
select(Sex) %>%
group_by(Sex) %>%
summarize(n=n()) %>%
mutate(percent = n/n())
# Sex
DATA %>%
select(Sex) %>%
group_by(Sex) %>%
summarize(n=n()) %>%
mutate(percent = n/sum(n))
DATA <- DATA %>% mutate(Sex = as_factor(Sex))
head(DATA)
DATA %>%
ggplot(aes(x=Sex))+
geom_histogram()
DATA %>%
ggplot(aes(x=Sex))+
geom_bar()
theme_light()
# Visualize
theme_minimal()
DATA %>%
ggplot(aes(x=Sex))+
geom_bar()
DATA %>%
select(Sex) %>%
group_by(Sex) %>%
summarize(n=n()) %>%
mutate(percent = n/sum(n))+
ggplot(aes(x=Sexy, y=percent))+
geom_bar()
DATA %>%
select(Sex) %>%
group_by(Sex) %>%
summarize(n=n()) %>%
mutate(percent = n/sum(n))%>%
ggplot(aes(x=Sexy, y=percent))+
geom_bar()
DATA %>%
select(Sex) %>%
group_by(Sex) %>%
summarize(n=n()) %>%
mutate(percent = n/sum(n))%>%
ggplot(aes(x=Sex, y=percent))+
geom_bar(stat='identity')
DATA %>%
select(Sex) %>%
group_by(Sex) %>%
summarize(n=n()) %>%
mutate(percent = n/sum(n))%>%
ggplot(aes(x=Sex, y=percent))+
geom_bar(stat='identity')+
theme_light()
DATA %>%
select(Sex) %>%
group_by(Sex) %>%
summarize(n=n()) %>%
mutate(percent = n/sum(n))%>%
ggplot(aes(x=Sex, y=percent))+
geom_bar(stat='identity')+
theme_minimal()
DATA %>%
select(Sex) %>%
group_by(Sex) %>%
summarize(n=n()) %>%
mutate(percent = n/sum(n))%>%
ggplot(aes(x=Sex, y=percent))+
geom_bar(stat='identity')+
scale_y_continuous(name = "Percent", breaks = seq(-1,1,0.1), labels = paste0(as.character(c(seq(-100,0,-10),seq(10,100,10),"%"))))
theme_minimal()
DATA %>%
select(Sex) %>%
group_by(Sex) %>%
summarize(n=n()) %>%
mutate(percent = n/sum(n))%>%
ggplot(aes(x=Sex, y=percent))+
geom_bar(stat='identity')+
scale_y_continuous(name = "Percent", breaks = seq(-1,1,0.1), labels = paste0(as.character(c(seq(-100,0,-10),seq(10,100,10),"%"))))+
theme_minimal()
install.packages('scales')
install.packages("scales")
library(tidyverse)
DATA %>%
select(Sex) %>%
group_by(Sex) %>%
summarize(n=n()) %>%
mutate(percent = n/sum(n))%>%
ggplot(aes(x=Sex, y=percent))+
geom_bar(stat='identity')+
scale_y_continuous(name = "Percent", breaks = seq(-1,1,0.1),
labels = percent_format(accuracy=1))+
theme_minimal()
library(scales)
DATA %>%
select(Sex) %>%
group_by(Sex) %>%
summarize(n=n()) %>%
mutate(percent = n/sum(n))%>%
ggplot(aes(x=Sex, y=percent))+
geom_bar(stat='identity')+
scale_y_continuous(name = "Percent", breaks = seq(-1,1,0.1),
labels = percent_format(accuracy=1))+
theme_minimal()
DATA %>%
select(Sex) %>%
group_by(Sex) %>%
summarize(n=n()) %>%
mutate(percent = n/sum(n))%>%
ggplot(aes(x=Sex, y=percent))+
geom_bar(stat='identity')+
scale_y_continuous(name = "Percent", breaks = seq(-1,1,0.1),
labels = percent_format(accuracy=1))+
ggtitle('Distribution of loaners with respect to sex')+
theme_minimal()
DATA %>%
select(Sex) %>%
group_by(Sex) %>%
summarize(n=n()) %>%
mutate(percent = n/sum(n))%>%
ggplot(aes(x=Sex, y=percent))+
geom_bar(stat='identity')+
scale_y_continuous(name = "Percent", breaks = seq(-1,1,0.1),
labels = percent_format(accuracy=1))+
ggtitle('Distribution of loaners with respect to sex')+
theme(plot.title= element_text(0.5))
DATA %>%
select(Sex) %>%
group_by(Sex) %>%
summarize(n=n()) %>%
mutate(percent = n/sum(n))%>%
ggplot(aes(x=Sex, y=percent))+
geom_bar(stat='identity')+
scale_y_continuous(name = "Percent", breaks = seq(-1,1,0.1),
labels = percent_format(accuracy=1))+
ggtitle('Distribution of loaners with respect to sex')+
theme(plot.title= element_text(hjust= 0.5))
## Housing -> stan zamieszkania
library(janitor)
DATA %>% select(Housing) %>% count()
DATA %>% select(Housing) %>% group_by(Housing) %>% count()
DATA <- DATA %>% mutate(Housing = as_factor(Housing))
head(DATA)
theme_set(theme_bw())
DATA %>%
select(Sex) %>%
group_by(Sex) %>%
summarize(n=n()) %>%
mutate(percent = n/sum(n))%>%
ggplot(aes(x=Sex, y=percent))+
geom_bar(stat='identity')+
scale_y_continuous(name = "Percent", breaks = seq(-1,1,0.1),
labels = percent_format(accuracy=1))+
ggtitle('Distribution of loaners with respect to sex')+
theme(plot.title= element_text(hjust= 0.5))
theme_update(plot.title = element_text(hjust=0.5))
DATA %>% tabyl(Housing)
DATA %>%
tabyl(Housing) %>%
ggplot(aes(x=Housing, y=percent))+
geom_bar(stat='identity')+
scale_y_continuous(name = "Percent", breaks = seq(-1,1,0.1),
labels = percent_format(accuracy=1))+
ggtitle('Distribution of housing status')
DATA %>% tabyl(Purpose)
## Purpose -> cel wzi
DATA %>% tabyl(Purpose)
DATA %>% mutate(Purpose = fct_lump(Purpose, prop=0.1))
DATA <- DATA %>% mutate(Purpose = fct_lump(Purpose, prop=0.1))
DATA %>% tabyl(Purpose)
DATA <- DATA %>% mutate(Purpose = as_factor(Purpose))
## Savings Account -> wysokosc oszczednosci na koncie oszczednosciowym
DATA %>% tabyl(Saving.accounts)
DATA <- DATA %>% mutate(Saving.accounts = as_factor(Saving.accounts))
mode <- function(data){
num_un <- unique(data)
mod <- num_un[which.max(tabulate(match(data, num_un)))]
}
DATA <- DATA %>% mutate(Saving.accounts = if_else(is.na(Saving.accounts), mode(Saving.accounts), Saving.accounts))
DATA %>% tabyl(Saving.accounts)
DATA <- DATA %>% mutate(Saving.accounts = fct_recode(Saving.accounts, "quite rich" = "rich"))
## Savings Account -> wysokosc oszczednosci na koncie oszczednosciowym
DATA %>% tabyl(Saving.accounts)
## Checking account
DATA %>% tabyl(Checking.account)
DATA <- DATA %>% mutate(Checking.account = as_factor(Checking.account))
DATA %>% tabyl(Checking.account)
DATA <- DATA %>% select(-Checking.account)
head(DATA)
## Risk
DATA %>% tabyl(Risk)
DATA %>% mutate(Risk = as_factor(Risk))
DATA<- DATA %>% mutate(Risk = as_factor(Risk))
DATA %>%
ggplot(aes(x = Age))+
geom_histogram()
## Age -> wiek
summary(DATA$Age)
# Za NA wrzucmy mediane
DATA <-  DATA %>% mutate(Age = if_else(is.na(Age), median(Age, na.rm = TRUE), Age))
## Age -> wiek
summary(DATA$Age)
DATA %>% ggplot(aes(x= Age))+geom_histogram()
# Jak to wyglada?
DATA %>% ggplot(aes(x= Age))+geom_histogram(binwidth = 2*IQR(DATA$Age)/length(DATA$Age)^(1/3))
## Job
DATA %>% tabyl(Job)
DATA <- DATA %>% mutate(Job = as_factor(Job))
DATA <- DATA %>% mutate(Job = fct_recode(Job,
"Unskilled" = "1",
"Unskilled" = "2",
"Skilled" = "3",
"Hskilled" = "4"))
head(DATA)
Credit.amount.eur <- function(x, FX = 1.95583){
return(x/FX)
}
Credit.amount.eur(100)
Credit.amount.eur(2)
DATA <- DATA %>% mutate(credit.amount.eur=credit.amount/1.95583) %>% select(-credit.amount)
View(Credit.amount.eur)
## Duration
DATA %>% tabyl(Duration)
## Other_credit
DATA %>% tabyl(Other_credit)
## emp.length
DATA %>% tabyl(emp.length)
## month.inc
summary(month.inc)
## month.inc
summarise(month.inc)
## month.inc
summary(month.inc)
## month.inc
summary(DATA$month.inc)
DATA <- DATA %>% mutatate(month.inc.eur = month.inc/1.95583) %>% select(-month.inc)
DATA <- DATA %>% mutate(month.inc.eur = month.inc/1.95583) %>% select(-month.inc)
DATA %>% ggplot(aes(x=month.inc.eur))+geom_histogram(binwidth=10)
## month.inc
summary(DATA$month.inc)
## month.inc
summary(DATA$month.inc.eur)
DATA <- DATA %>% filter(month.inc.eur > 0)
# DTI -> Debt to installment ratio
summary(DATA$DTI)
# installment -> splata
# do domu:
# Napisz
summary(DATA)
# installment -> splata
# do domu:
# Napisz
summary(DATA$installment)
DATA %>% filter(is.na(installment))
DATA %>% filter(is.na(installment)) %>% select(credit.amount.eur)
# installment -> splata
# do domu:
# Installmenty sa N/A niektore. To akurat mozna ladnie policzyc z danych (wysokosc kredytu/dlugosc splaty)
DATA <- DATA %>%
mutate(installment = if_else(is.na(installment), median(installment, na.rm=T), installment))
summary(DATA$installment)
DATA %>% summarise_all(~sum(is.na()))
DATA %>% summarise_all(~sum(is.na(.)))
install.packages("ggcorrplot")
# Jak zmienne miedzy soba pracuja?
library(ggcorrplot)
DATA %>%
select_if(is.numeric) %>%
pairs()
# Lipa, bo nieliniowe. Moze Corr. Spearmana?
DATA %>% select_if(is.numeric) %>% cor(method="spearman")
DATA %>%
select_if(is.numeric) %>%
cor(method="spearman")%>%
ggcorrplot()
DATA %>%
select_if(is.numeric) %>%
cor(method="spearman")%>%
ggcorrplot(type='lower')
DATA %>%
select_if(is.numeric) %>%
cor(method="spearman")%>%
ggcorrplot(type='lower', lab=T)
install.packages('DescTools')
# Sa bardzo duze korelacje (DTI vs month.inc.eur)
DATA <- DATA %>% select(-month.inc.eur)
library(DescTools)
DATA %>% select_if(is.factor) %>%
PairApply(CramerV) %>%
ggcorrplot(type='lower', lab=T)
DATA_s <- DATA
DATA_s <- DATA %>%
select(Age, DTI, emp.length) %>%
mutate(Age_s = scale(Age),
DTI_s = scale(DTI),
emp.length_s = scale(emp.length)) %>%
select(-c(Age, DTI, emp.length))
head(DATA_s)
# Algorytm k-srednich
clust <- DATA_s %>% kmeans(centers= 3)
clust
install.packages('plotly'0
install.packages('plotly')
clust_tidy <- as_tibble(clust$centers)
clust_tidy <- clust_tidy %>%
mutate(Age = Age_s * sd(DATA$Age) + mean(DATA$Age),
DTI = DTI_s * sd(DATA$DTI) + mean(DATA$DTI),
emp.length = emp.length_s * sd(DATA$emp.length) + mean(DATA$emp.length)) %>%
select(-c(Age, DTI, emp.length))
library(plotly)
DATA %>%
plot_ly(x=~Age, y=~DTI, z=~emp.length, color = clust$cluster) %>%
add_markers(size=1.5)
DATA= DATA %>% add_column(id = 1:nrow(DATA))
train = DATA %>% sample_frac(.7)
test = anti_join(DATA, train, by='id')
model <- glm(Risk ~., family = 'binomial', data =subset(train, select=c(-id)))
summary(model)
pred <- predict(model, newdata = test, type = "response")
install.packages('pROC')
library(pRoc)
library(pROC)
roc_curve  = roc(response = test$Risk, predictor =  pred)
plot(roc_curve)
roc_curve$auc
